!* ========================================================================== *
!*                                                                            *
!* Copyright (C) 2020 Intel Corporation                                       *
!* This file is part of the FALCO library.                                    *
!*                                                                            *
!* For information on the license, see the LICENSE file.                      *
!* Further information: https://github.com/giacrossi/FALCO/                   *
!* SPDX-License-Identifier: BSD-3-Clause                                      *
!*                                                                            *
!* ========================================================================== *
!* Giacomo Rossi (Intel Corporation)                                          *
!* ========================================================================== *

         integer(I4P), intent(in), optional                               :: omp_dev
         type(c_ptr)                                                      :: cptr_dev
         integer(kind=c_int)                                              :: omp_device

         if (present(omp_dev)) then
            omp_device = int(omp_dev, c_int)
         else
            omp_device = int(omp_get_default_device(), c_int)
         endif

         cptr_dev = c_loc(fptr_dev)

         call omp_target_free_c(cptr_dev, omp_device)
         !nullify(fptr_dev)
         fptr_dev => null()

